         CBL LIB
       IDENTIFICATION DIVISION.
       PROGRAM-ID. 'COBEXMPL'.
      *
      * THIS PROGRAM ILLUSTRATES EXAMPLES OF MATRIX API CALLS
      * THIS PROGRAM DOES NOT PERFORM ANY USEFUL APPLICATIONS
      * FUNCTION AND DOES NOT NECESARILY ILLUSTRATE GOOD PROGRAMMING
      * PRACTICE.
      *
      * AUTHOR: SIMON SPANCHAK
      *
      *
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
      ***************** ALTERED **************************************
       SOURCE-COMPUTER. IBM-370.
       OBJECT-COMPUTER. IBM-370.
      ***************** ALTERED - END ********************************
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.

       DATA DIVISION.
       FILE SECTION.

       WORKING-STORAGE SECTION.

       01  WS-EYE-CATCHER.
           05  WS-PROGRAM-NAME             PIC X(08) VALUE 'MATRIX'.
           05  FILLER                      PIC X(24)
               VALUE ' WORKING-STORAGE'.
       01  WS-MESSAGE                      PIC X(40).
       01  WS-SAVE-KEY                     PIC 9(9) COMP.
       01 TOKEN-1                     PIC X(20).
       01 TOKEN-2                     PIC X(20).
       01 WS-DSNAME1                  PIC X(44).
       01 FOUND-ADDR                  PIC 9(9).
       01 WS-DATA-AREA                PIC X(200)
               VALUE 'M1M2M3M4M5M6M8M9M0OIQUEUFDJHXUJE123456M70000'.
      *
      * COPY MATRIX INTERFACE PLIST
      *
             COPY MXPLIST.
      *
      * ===========================
      *
      *
      * LINKAGE SECTION
      *
       LINKAGE SECTION.
       EJECT
      *
      *    PROCEDURE DIVISION
      *
       PROCEDURE DIVISION.

       0000-MAINLINE.
      *
      *    OBTAIN AN ACCESS TOKEN FOR MATRIX
      *
           DISPLAY 'ACCESS MATRIX'.
           MOVE MATRIX-ACCESS TO MATRIX-REQUEST.
           MOVE LOW-VALUES    TO MATRIX-ACCESS-TOKEN.
           MOVE 'MTRX'        TO MATRIX-ACCESS-NAME.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE NOT = 0
           THEN PERFORM 9000-MESSAGE
                GOBACK.
      *
      *    CREATE WORK AREAS
      *
           DISPLAY 'CREATE A WORK AREA VWA1'.
           MOVE MATRIX-CREATE-WA TO MATRIX-REQUEST.
           MOVE 'VWA1'        TO MATRIX-CREATEWA-NAME.
           MOVE 3200000000    TO MATRIX-CREATEWA-SIZE.
           MOVE MATRIX-SYNC   TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
           DISPLAY 'CREATE WORK AREA VWA2'.
           MOVE MATRIX-CREATE-WA TO MATRIX-REQUEST.
           MOVE 'VWA2'        TO MATRIX-CREATEWA-NAME.
           MOVE 3200000       TO MATRIX-CREATEWA-SIZE.
           MOVE MATRIX-SYNC   TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    COPY DATA FROM WORKSPACE 1 TO OTHER SPACE
      *
           DISPLAY 'COPY DATA FROM WORKSPACE 1 TO WA2'.
           MOVE MATRIX-COPY-WA TO MATRIX-REQUEST.
           MOVE 'VWA1' TO MATRIX-COPY-FROM-WANAME.
           MOVE 'VWA2' TO MATRIX-COPY-TO-WANAME.
           MOVE 50000  TO MATRIX-COPY-LENGTH.
           MOVE 0      TO MATRIX-COPY-FROM-ADDRESS.
           MOVE 0      TO MATRIX-COPY-TO-ADDRESS.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    CONNECT TO WORKSPACE2
      *
           DISPLAY 'CONNECT TO WORKSPACE2 '.
           MOVE MATRIX-CONNECT-WA TO MATRIX-REQUEST.
           MOVE 'VWA2'      TO MATRIX-CONNECT-WA-NAME.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
                MOVE MATRIX-RETURN-CONNECT-TOKEN TO TOKEN-2
           ELSE PERFORM 9000-MESSAGE
                GO TO 1000-DELETE-ALL.
      *
      *    WRITE TO WORKSPACE
      *
           DISPLAY 'WRITE SYNC TO WORKSPACE 2 '.
           MOVE MATRIX-WRITE-WA TO MATRIX-REQUEST.
           MOVE TOKEN-2 TO MATRIX-WRITE-TOKEN.
           MOVE 100     TO MATRIX-WRITE-TO-ADDRESS.
           MOVE 200     TO MATRIX-WRITE-LENGTH.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG WS-DATA-AREA.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
           DISPLAY 'WRITE ASYNCH TO WORKSPACE 2 '.
           MOVE MATRIX-WRITE-WA TO MATRIX-REQUEST.
           MOVE TOKEN-2 TO MATRIX-WRITE-TOKEN.
           MOVE 100     TO MATRIX-WRITE-TO-ADDRESS.
           MOVE 200     TO MATRIX-WRITE-LENGTH.
           MOVE MATRIX-ASYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG WS-DATA-AREA.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    READ FROM WORKSPACE2
      *
           DISPLAY 'READ FROM WORKSPACE2 '.
           MOVE MATRIX-READ-WA TO MATRIX-REQUEST.
           MOVE TOKEN-2 TO MATRIX-READ-TOKEN.
           MOVE 100     TO MATRIX-READ-FROM-ADDRESS.
           MOVE 200     TO MATRIX-READ-LENGTH.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG WS-DATA-AREA.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
                DISPLAY MATRIX-ACTUAL-LEN-READ
                DISPLAY WS-DATA-AREA
           ELSE PERFORM 9000-MESSAGE.
      *
           MOVE 'DEV.SPACE.AAAA' TO WS-DSNAME1.
      *
      *    SAVE DATA IN WORKSPACE 2 TO A FILE
      *
           DISPLAY 'SAVE DATA FROM WORKSPACE 2 TO A FILE'.
           MOVE MATRIX-SAVE-WA TO MATRIX-REQUEST.
           MOVE 'VWA2' TO MATRIX-SAVE-WA-NAME.
           MOVE WS-DSNAME1 TO MATRIX-SAVE-DSNAME.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      * SET RECORD SIZE IN A WORKAREA
      *
           DISPLAY 'SET WORKSPACE RECORD SIZE'.
           MOVE  MATRIX-SET-RECSIZE TO MATRIX-REQUEST.
           MOVE TOKEN-2 TO MATRIX-SET-RECSIZE-TOKEN.
           MOVE 80      TO MATRIX-NEW-REC-SIZE.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    LOAD DATA INTO A WORKSPACE 1 FROM FILE
      *
           DISPLAY 'LOAD DATA INTO WORKSPACE 1 '.
           MOVE MATRIX-LOAD-WA TO MATRIX-REQUEST.
           MOVE 'VWA1' TO MATRIX-LOAD-WA-NAME.
           MOVE WS-DSNAME1 TO MATRIX-LOAD-WA-DSNAME.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    ASSOCIATE A WORK AREA WITH A DATASET
      *
           DISPLAY 'ASSOCIATE WORKAREA'.
           MOVE MATRIX-FILEASSOCIATE  TO MATRIX-REQUEST.
           MOVE MATRIX-ASSOCIATE-WA  TO MATRIX-ASSOC-TYPE.
           MOVE 'VWA2' TO MATRIX-ASSOC-WA-NAME.
           MOVE WS-DSNAME1 TO MATRIX-ASSOC-DSNAME.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    SEARCH IN WORKSPACE
      *
           DISPLAY 'SEARCH IN WORKSPACE 2 '.
           MOVE MATRIX-SEARCH-WA TO MATRIX-REQUEST.
           MOVE TOKEN-2 TO MATRIX-SEARCH-TOKEN.
           MOVE LOW-VALUES TO MATRIX-SEARCH-WA-NAME.
           MOVE 100    TO MATRIX-SEARCH-START-ADDRESS.
           MOVE 150000 TO MATRIX-SEARCH-SCAN-LENGTH.
           MOVE 2      TO MATRIX-SEARCH-DATA-LENGTH.
           MOVE 'M7'   TO MATRIX-SEARCH-DATA.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG OMITTED.
           IF RETURN-CODE = 0
           THEN MOVE MATRIX-RETURN-FOUND-ADDRESS TO FOUND-ADDR
                DISPLAY 'STUFF FOUND AT ', FOUND-ADDR
           ELSE PERFORM 9000-MESSAGE.
      *
      * ALTERNATE SEARCH IN WORKSPACE
      *
           DISPLAY 'ALTERNATE SEARCH IN WORKSPACE 2 '.
           MOVE MATRIX-SEARCH-WA TO MATRIX-REQUEST.
           MOVE 'VWA2' TO MATRIX-SEARCH-WA-NAME.
           MOVE 100    TO MATRIX-SEARCH-START-ADDRESS.
           MOVE 150000 TO MATRIX-SEARCH-SCAN-LENGTH.
           MOVE 2      TO MATRIX-SEARCH-DATA-LENGTH.
           MOVE 'M7'   TO MATRIX-SEARCH-DATA.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN MOVE MATRIX-RETURN-FOUND-ADDRESS TO FOUND-ADDR
                DISPLAY 'STUFF FOUND AT ', FOUND-ADDR
           ELSE PERFORM 9000-MESSAGE.
      *
      *    CONNECT TO WORKSPACE1
      *
           DISPLAY 'CONNECT TO WORKSPACE1 '.
           MOVE MATRIX-CONNECT-WA TO MATRIX-REQUEST.
           MOVE 'VWA1'      TO MATRIX-CONNECT-WA-NAME.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
                MOVE MATRIX-RETURN-CONNECT-TOKEN TO TOKEN-1
           ELSE PERFORM 9000-MESSAGE
                GO TO 1000-DELETE-ALL.
      *
      *    LOCK A WORKSPACE
      *
           DISPLAY 'LOCK WORKAREA'.
           MOVE MATRIX-LOCK-WA  TO MATRIX-REQUEST.
           MOVE TOKEN-1 TO MATRIX-LOCK-TOKEN.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN MOVE MATRIX-RETURN-KEY TO WS-SAVE-KEY
                DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      * ADJUST SIZE OF WORK SPACE
      *
           DISPLAY 'ADJUST SIZE OF WORKSPACE 1'.
           MOVE  MATRIX-SET-VWASIZE TO MATRIX-REQUEST.
           MOVE 'VWA1'    TO MATRIX-ADJUST-NAME.
           MOVE 3200000 TO MATRIX-ADJUST-SIZE.
           MOVE WS-SAVE-KEY TO MATRIX-ADJUST-KEY.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    UNLOCK A WORKSPACE
      *
           DISPLAY 'UNLOCK WORKAREA'.
           MOVE MATRIX-UNLOCK-WA  TO MATRIX-REQUEST.
           MOVE TOKEN-1 TO MATRIX-LOCK-TOKEN.
           MOVE WS-SAVE-KEY TO MATRIX-LOCK-KEY.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG WS-DATA-AREA.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    DISASSOCIATE A WORK AREA FROM A DATASET
      *
           DISPLAY 'DISASSOCIATE WORKAREA'.
           MOVE MATRIX-FILEASSOCIATE  TO MATRIX-REQUEST.
           MOVE MATRIX-DISASSOCIATE-WA  TO MATRIX-ASSOC-TYPE.
           MOVE 'VWA2' TO MATRIX-ASSOC-WA-NAME.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    DISCONNECT FROM WORK SPACE2
      *
           DISPLAY 'DISCONNECT FROM WORKSPACE2 '.
           MOVE MATRIX-DISCONNECT-WA TO MATRIX-REQUEST.
           MOVE TOKEN-2 TO MATRIX-DISCONNECT-TOKEN.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG OMITTED.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    EXCHANGE WORK SPACES
      *
           DISPLAY 'EXCHANGE WORKSPACES'.
           MOVE MATRIX-EXCHANGE      TO MATRIX-REQUEST.
           MOVE 'VWA1'    TO MATRIX-EXCHANGE-SOURCE-NAME.
           MOVE 'VWA2'    TO MATRIX-EXCHANGE-TARGET-NAME.
           MOVE MATRIX-FORCE TO MATRIX-EXCHANGE-INUSE.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    POST EVENT
      *
           DISPLAY 'POST EVENT'.
           MOVE MATRIX-POST-EVENT TO MATRIX-REQUEST.
           MOVE 'AAAAAAAA' TO MATRIX-EVENT-NAME.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    WAIT ON EVENT
      *
           DISPLAY 'WAIT ON EVENT'.
           MOVE MATRIX-WAIT-EVENT TO MATRIX-REQUEST.
           MOVE 'AAAAAAAA' TO MATRIX-EVENT-NAME.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    RESET EVENT
      *
           DISPLAY 'RESET EVENT'.
           MOVE MATRIX-RESET-EVENT TO MATRIX-REQUEST.
           MOVE 'AAAAAAAA' TO MATRIX-EVENT-NAME.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    DELETE EVENT
      *
           DISPLAY 'DELETE EVENT'.
           MOVE MATRIX-DELETE-EVENT TO MATRIX-REQUEST.
           MOVE 'AAAAAAAA' TO MATRIX-EVENT-NAME.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    DELETE WA1
      *
       1000-DELETE-ALL.
           DISPLAY 'DELETE WORKSPACE VWA1'.
           MOVE MATRIX-DELETE-WA TO MATRIX-REQUEST.
           MOVE 'VWA1' TO MATRIX-DELETEWA-NAME.
           MOVE MATRIX-FORCE TO MATRIX-DELETEWA-FORCE.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *    DELETE WA2
      *
           DISPLAY 'DELETE WORKSPACE VWA2'.
           MOVE MATRIX-DELETE-WA TO MATRIX-REQUEST.
           MOVE 'VWA2' TO MATRIX-DELETEWA-NAME.
           MOVE MATRIX-SYNC TO MATRIX-REQUEST-FLAG.
           CALL 'MXSTUB'  USING MATRIX-REQUEST-MSG.
           IF RETURN-CODE = 0
           THEN DISPLAY 'REQUEST SUCCESSFUL'
           ELSE PERFORM 9000-MESSAGE.
      *
      *
       1000-EXIT.
           GOBACK.
      *
      ******************************************************************
      * DISPLAY RETURN CODE VALUES                                     *
      ******************************************************************
      *
       9000-MESSAGE.
           IF RETURN-CODE = 4
                MOVE 'REQUEST FAILED' TO WS-MESSAGE
                DISPLAY WS-MESSAGE
                MOVE  MATRIX-RETURN-MESSAGE TO WS-MESSAGE
              ELSE IF RETURN-CODE = 8
                 MOVE 'MATRIX IS QUIESCING' TO WS-MESSAGE
              ELSE IF RETURN-CODE = 12
                 MOVE 'MATRIX NOT FOUND' TO WS-MESSAGE
              ELSE IF RETURN-CODE = 16
                 MOVE 'INSUFFICIENT STORAGE' TO WS-MESSAGE
              ELSE IF RETURN-CODE = 20
                 MOVE 'REQUEST NOT SUPPORTED' TO WS-MESSAGE
              ELSE IF RETURN-CODE = 24
                 MOVE 'APPLICATION IS LOCKED' TO WS-MESSAGE
              ELSE IF RETURN-CODE = 28
                 MOVE 'APPLICATION NOT INITIALIZED' TO WS-MESSAGE
              ELSE IF RETURN-CODE = 32
                 MOVE 'ERROR IN REQUEST' TO WS-MESSAGE
              ELSE IF RETURN-CODE = 36
                 MOVE 'REQUEST DISPATCHED' TO WS-MESSAGE.

           DISPLAY WS-MESSAGE.
       9000-EXIT.

